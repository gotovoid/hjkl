---
layout:     post
title:      谈谈vim设置(全局/局部)
comments:   true
category:   vim
tags:       [vim]
published:  true
---

我们都知道, 可以在`.vimrc`中, 写下一连串的`:set xxx=yyy`来对vim进行设置.  
我们往往忽略了`:set`命令的作用域, 在大部分情况下, 都不会影响大局.  
本文讲一下, `:setl`(setlocal)与`:setg`(setglobal)的区别.  
搞清它们的区别也许不重要, 但是了解一下也没坏处.

----

跟据值类型, 可以分为3种:

- boolean - 布尔型, 如: number, list, wrap等.
- number - 数字型, 如: tabstop, textwidth, colorcolumn等.
- string - 字符型, 如: spelllang, path, guioptions等

> 这个容易理解, 就不说了.

跟据作用域, 也可分为3种:

- global - 全局唯一: 无论在哪里设置, 都可以改变全局值.
- local to window - 每个window一份: 在本window中设置, 不影响其他window
- local to buffer - 每个buffer一份: 对本buffer进行设置, 不影响其他buffer

首先需要搞清楚, global/window/buffer的概念:

- global - 无论你打开了多少Tab, 把屏幕split成几块.
  它们都共享同一套全局设置, 如: runtimepath, cryptmethod等.
- window - 运行`:split`命令后, 就把一个window变成了两个window.
  运行`:tabnew`命令后, 就在另一个Tab中创造了一个window.
  依附在window上的设置包括: number, colorcolumn等.
- buffer - 你可以使用`:ls`命令查看buffer列表, buffer对应着你所操作的文件, 
  buffer可以在window中显示, 甚至可以在多个window中同时显示, 也可以隐藏.
  依附在buffer上的设置包括: fileencoding, list等.

这些设置的作用域是vim硬性规定的, 其中global类型最不灵活.
不同版本的vim, 作用域会不同. 比如, 高版本的vim为某些原先是global类型的设置, 添加"local to window/buffer"作用域.
我以`cm(cryptmethod)`为例:

当你在某个buffer中, 运行`:set cm=zip`后, 切换到另一个buffer, 再运行`:setlocal cm=bluefish`
(如果使用`:set cm=bluefish`, 会影响全局设置).  
然后切换会刚才的buffer, `cm(cryptmethod)`仍然是`zip`, 也就是说, 可以在不同的buffer中使用不同的`cm`.

有些global设置没有"local to buffer"功能, 无论你用`:set`/`:setlocal`/`:setglobal`效果都一样, 即改变全局配置.

再来谈谈local to window/buffer类型的设置:

- 当创建一个新的window/buffer时, vim会把当前window/buffer的全局配置(local-global), 赋给新的window/buffer.
  这里的local-global配置, 不同于上述global配置. 我举个例子, 你就能明白了:

        :set number
        :e a.txt
        :setlocal nonumber
        :e b.txt

  * `:set number`其实做了两件事情, 它同时`:setglobal number`又`:setlocal number`, 当前window左侧显示了行号.  
  * `:e a.txt`打开a.txt
  * `:setlocal nonumber`, 我用这条命令, 隐藏了行号, 当时没有影响local-global设置, 可以使用`:setg nu?`查看
  * `:e b.txt`打开b.txt, 左侧的行号又出现了. 这是因为在同一个window中, 打开一个新buffer时, vim使用的是`number`的`local-global`值.
- 当打开一个之前打开过的buffer时, vim一般会采用该buffer之前设置. 即, buffer具有记忆功能.

总结
----
- vim设置, 一共有3种作用域: global, local to window, local to buffer.
- 有些global设置, 附带local to window/buffer作用域
- local to window/buffer的设置, 又有local-global, local-local之分.
