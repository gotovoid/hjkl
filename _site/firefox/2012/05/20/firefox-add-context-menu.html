<!DOCTYPE html>
<html>
    <head>
        <meta charset='utf-8'>
        <title>  增加firefox右击菜单 -  HJKL </title>
        <link rel="stylesheet" type="text/css" href="/css/stylesheet.css" media="screen" />
        <link rel="stylesheet" type="text/css" href="/css/pygments/default.css" media="screen" />
        <!-- <link rel="stylesheet" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.20/themes/base/jquery-ui.css" type="text/css" media="screen" charset="utf-8"> -->
        <!-- <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js" type="text/javascript" charset="utf-8"></script> -->
        <!-- <script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.20/jquery-ui.js" type="text/javascript" charset="utf-8"></script> -->
        <script type="text/javascript">
            /*
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-32078285-1']);
            _gaq.push(['_trackPageview']);

            (function() {
                var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
                    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();
            */
        </script>
        <style type="text/css">
        </style>
    </head>
    <body class="container">

        <header>
        <h1 id="title">HJKL</h1>
        <h2 id="subtitle">Simplicity is the ultimate sophistication. — Leonardo Da Vinci</h2>
            <nav>
            <ol>
                <li><a href="/" class="btn">主页</a></li>
                <li><a href="/about.html" class="btn">关于</a></li>
            </ol>
            </nav>
        </header>

        <section id="main_content">
        <h2>工具</h2>

<ul>
<li><code>firefox</code></li>
<li>高级文本编辑器: <code>vim</code>, <code>notepad++</code>等</li>
<li>压缩/解压缩工具: <code>zip</code>/<code>unzip</code>, <code>7z</code>等</li>
</ul>


<h2>修改<code>omni.ja</code></h2>

<h3>解压缩<code>omni.ja</code></h3>

<pre><code>mkdir ~/firefox &amp;&amp; cd ~/firefox
cp /usr/lib/firefox/omni.ja .
unzip omni.ja -d omni
cd omni
</code></pre>

<h3>编辑<code>browser.xul</code></h3>

<pre><code>vim ./chrome/browser/content/browser/browser.xul
</code></pre>

<div class="highlight"><pre><code class="xml"><span class="nt">&lt;menupopup</span> <span class="na">id=</span><span class="s">&quot;contentAreaContextMenu&quot;</span><span class="nt">&gt;</span>
    <span class="c">&lt;!-- SKIP --&gt;</span>
    <span class="c">&lt;!-- SKIP --&gt;</span>
    <span class="c">&lt;!-- SKIP --&gt;</span>
    <span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">&quot;context-inspect&quot;</span><span class="nt">/&gt;</span>

    <span class="c">&lt;!-- ADD by Kev++ BEGIN --&gt;</span>
    <span class="nt">&lt;menuseparator</span> <span class="na">id=</span><span class="s">&quot;kev-separator&quot;</span><span class="nt">/&gt;</span>

    <span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">&quot;context-toggle-proxy&quot;</span>
              <span class="na">label=</span><span class="s">&quot;Toggle Proxy&quot;</span>
              <span class="na">oncommand=</span><span class="s">&quot;var stat = gPrefService.getIntPref(&#39;network.proxy.type&#39;);</span>
<span class="s">                         var port = gPrefService.getIntPref(&#39;network.proxy.socks_port&#39;);</span>
<span class="s">                         this.setAttribute(&#39;label&#39;, &#39;Toggle Proxy: &#39;+port.toString());</span>
<span class="s">                         if(!stat)</span>
<span class="s">                             this.setAttribute(&#39;checked&#39;, &#39;true&#39;);</span>
<span class="s">                         else</span>
<span class="s">                             this.removeAttribute(&#39;checked&#39;);</span>
<span class="s">                         gPrefService.setIntPref(&#39;network.proxy.type&#39;, !stat);&quot;</span>
              <span class="nt">/&gt;</span>

    <span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">&quot;context-restart&quot;</span>
              <span class="na">label=</span><span class="s">&quot;Restart&quot;</span>
              <span class="na">oncommand=</span><span class="s">&quot;const nsIAppStartup = Components.interfaces.nsIAppStartup;</span>
<span class="s">                         Components.classes[&#39;@mozilla.org/toolkit/app-startup;1&#39;].getService(nsIAppStartup)</span>
<span class="s">                                   .quit(nsIAppStartup.eRestart | nsIAppStartup.eAttemptQuit);&quot;</span>
              <span class="nt">/&gt;</span>

    <span class="nt">&lt;menuitem</span> <span class="na">id=</span><span class="s">&quot;context-quit&quot;</span>
              <span class="na">label=</span><span class="s">&quot;Quit&quot;</span>
              <span class="na">command=</span><span class="s">&quot;cmd_quitApplication&quot;</span>
              <span class="nt">/&gt;</span>
    <span class="c">&lt;!-- ADD by Kev++ END --&gt;</span>

<span class="nt">&lt;/menupopup&gt;</span>
</code></pre>
</div>


<blockquote><p>说明: 把代码插入到不同的位置, 可以改变菜单项的排列顺序</p></blockquote>

<h3>压缩/覆盖<code>omni.ja</code></h3>

<pre><code>zip -r omni.ja *
sudo mv omni.ja /usr/lib/firefox/
</code></pre>

<h2>最终效果</h2>

<pre><code>| ...          |
|--------------|
| Toggle Proxy |
| Restart      |
| *Quit*       |
|--------------|
</code></pre>

<h2>注意事项</h2>

<p>一定要[启用/禁用]任意一个插件, 来重新加载<code>omni.ja</code></p>

<h2>参考</h2>

<ul>
<li>https://developer.mozilla.org/en/XUL/PopupGuide/Extensions</li>
<li>http://superuser.com/questions/421800/how-to-append-customer-context-menuitem-to-the-last-postion-in-firefox</li>
<li>http://superuser.com/questions/421809/how-to-add-a-proxy-on-off-context-menuitem-to-firefox</li>
<li>http://kb.mozillazine.org/Firefox<em>:</em>Tips<em>:</em>Customize_context_menu</li>
<li>http://kb.mozillazine.org/UserChrome.css_Element_Names/IDs</li>
<li>https://developer.mozilla.org/en/FirefoxOverlayPoints/Menus</li>
<li>http://www.rdrop.com/~half/Creations/Writings/TechNotes/firefox.menus.html</li>
</ul>


        </section>

        <footer>
        <div class="container">
            Copyright &copy; <a href="/">Kev++</a>
            All rights reserved.
        </div>
        </footer>

</body>
</html>
